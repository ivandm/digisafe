{% extends "companies/index_base.html" %}
{% load i18n static %}

{% block content %}
<div class="container">
    {# INFO WORK SESSION #}
    <div class="my-2">

        {# BOTTONI MAPPA E MODIFICA #}
        <div class="submit-row float-end p-1 border rounded">
            <a href="{% url 'companies:openmap' sb.id %}" class="btn btn-info  "  data-bs-toggle="tooltip"
                   data-bs-placement="top" title="Open map"><i class="bi bi-map-fill"></i></a>
            <a href="{% url 'companies:sessionbook-update' sb.id %}" class="btn btn-success  "
               data-bs-toggle="tooltip" data-bs-placement="top" title="Update Session"><i class="bi bi-pencil-fill"></i></a>
        </div>

        {# DATI DELLA WORK SESSION #}
        <div class="bg-light p-2 border">
            <h1 class="fw-bold border-bottom">Work sessions id {{sb.id}}</h1>
            <div class="row">
                <div class="col-2"><span class="">Name session:</span></div>
                <div class="col"><p class="fw-bold">{{ sb.name }}</p></div>
            </div>

            <div class="row">
                <div class="col-2"><span class="">Address session:</span></div>
                <div class="col"><p class="fw-bold">{{ sb.address }}</p></div>
            </div>

            <div class="row">
                <div class="col-2"><span class="">Session notes:</span></div>
                <div class="col"><p class="fw-bold">{{ sb.note }}</p></div>
            </div>

            <div class="row">
                <div class="col-2"><span class="">Session expiration date:</span></div>
                <div class="col"><p class="fw-bold">{{ sb.expire_date }}</p></div>
            </div>
        </div>
    </div>

    {# USERS LIST INVITED & DECLINED #}
    <div class="border p-2">
        <h2 class="fw-bold border-bottom">Users in session </h2>
        <div class="row">
            <div class="col fw-bold">Invited list</div>
            <div class="col fw-bold">Declined list</div>
        </div>
        <div class="row">
            <div class="col">
                {# Invited list #}
                <ul class="list-unstyled">
                    {% for user in sb.user_option_list.all %}
                    <li>{{user}}</li>
                    {% endfor %}
                </ul>

            </div>
            <div class="col">
                {# Declined list #}
                <ul class="list-unstyled">
                    {% for user in sb.user_decline_list.all %}
                    <li>{{user}}</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>


    <h2>Users booked</h2>

    {# HEAD GRID #}
    <div class="row fw-bold mb-3">
        <div class="col bg-secondary mx-1">Dates</div>
        <div class="col bg-secondary mx-1">Jobs</div>
        <div class="col bg-secondary mx-1 text-center">Users self booked</div>
        <div class="col bg-secondary mx-1 text-center">Users company confirmed</div>
    </div>

    {# BODY GRID #}
    {% for date in sb.datebook_set.all %}
    <div class="row  mb-1 ">

        <div class="col mx-1 border border-2 align-self-stretch ">{{date.date}}</div>
        <div class="col mx-1 border border-2 align-self-stretch ">{{date.job.title}}</div>

        <div class="col mx-1 border border-2 align-self-stretch align-self-center ">
            <form method="post">{% csrf_token %}
                <input type="hidden" name="datebook_id" value="{{date.id}}">
                <div class="row align-items-center">
                    <div class="col align-self-stretch ">
                        {% for user in date.user_booked %}
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="{{user.id}}" name="users" id="flexCheckDefault_{{user.id}}">
                            <label class="form-check-label" for="flexCheckDefault_{{user.id}}">
                            {{user}}
                            </label>
                        </div>
                        {% endfor %}
                    </div>
                    <div class="col-1 m-0 p-0 align-self-stretch text-center">
                        <button class="btn m-0 p-0" type="submit" id="confirm" name="confirm"
                        data-bs-toggle="tooltip" data-bs-placement="top" title="Add confirm list">
                            <i class="bi bi-arrow-right-square"></i></button>
                    </div>
                </div>
            </form>
        </div>

        <div class="col mx-1 border border-2 align-self-stretch align-self-center ">
            <form method="post">{% csrf_token %}
                <input type="hidden" name="datebook_id" value="{{date.id}}">
                <div class="row align-items-center">
                    <div class="col-1 m-0 p-0 align-self-stretch  text-center">
                        <button class="btn m-0 p-0" type="submit" id="confirm" name="confirm"
                        data-bs-toggle="tooltip" data-bs-placement="top" title="Remove confirm list">
                            <i class="bi bi-arrow-left-square"></i></button>
                    </div>
                    <div class="col align-self-stretch ">
                        {% for user in date.users_confirm.all %}
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="{{user.id}}" name="users_confirm" id="flexCheckDefault_{{user.id}}">
                            <label class="form-check-label" for="flexCheckDefault_{{user.id}}">
                            {{user}}
                            </label>
                        </div>
                        {% endfor %}
                    </div>

                </div>
            </form>
        </div>

    </div>
    {% endfor %}

</div>
{% endblock %}
